---
description: 'Коннект к Ganache, первые действия в консоли Truffle'
---

# Настройка проекта

### Настройка Ganache

Для разработки и тестирования контрактов нам понадобится блокчейн для разработки. В разделе "Настройка окружения" мы установили Ganache. Запустим его. На первом экране стоит выбрать "**New Workspace**" \("Quickstart" тоже сработает, но "New Workspace" дает больше контроля\). Ganache предложит придумать название, и выбрать проекты. Нам сейчас нужно нажать "**Add project**", и выбрать файл конфигурации нашего проекта **truffle-config.js**, полученный на предыдущем шаге. В целом никакие настройки можно больше не трогать. Нажимаем "**Save workspace**", и Ganache поднимает новый тестовый блокчейн для нас.

Сразу же можно увидеть список адресов тестовых аккаунтов, их балансы, мнемоническую фразу, по которой они были сгенерированы, и, если кликнуть на значок ключа, приватный ключ для каждого отдельного аккаунта. Их вполне можно экспорировать по этим приватным ключам в MetaMask, только прежде в ней нужно добавить кастомную сеть \(Сети &gt; Пользовательский RPC, после чего указать RPC SERVER/ID, которые можно найти в шапке окна Ganache\). Однако, нам это сейчас не нужно, т.к. все взаимодействия с контрактами в рамках этого гайда мы будем совершать через консоль/автотесты.

### Настройка Truffle для работы с Ganache

После создания проекта Ganache предоставил нам в шапке окна все необходимые данные для коннекта к блокчейну - **RPC SERVER, NETWORK ID**

Откроем файл **truffle-config.js** в нашем проекте. Его содержимое можно стереть и заменить на:

```javascript
module.exports = {
    networks: {
        development: {
            host: "127.0.0.1",
            port: 7545,
            network_id: "*"
        }
    },
    compilers: {
        solc: {
            version: "0.8.4"
        }
    }
};
```

Рассмотрим подробнее.  
Блок **networks** описывает сети, к которым сможет подключаться Truffle для деплоя контрактов, использования консоли. Сетей может быть несколько, но сейчас у нас добавлена лишь тестовая сеть Ganache. **host** - часть **RPC SERVER**, после http:// и до последнего двоеточия. **port** - часть **RPC SERVER** после последнего двоеточия. **network\_id** в файле конфигурации можно указать так: **"\*"**. Это означает "любой ID сети".  
  
Блок **compilers** отвечает за настройки компилятора, его версию в частности. Его можно указать как в примере, проблем быть не должно.

### Взаимодействия с блокчейном и первые действия в консоли Truffle

Итак, чтобы проверить, что все прошло успешно, попробуем провзаимодействовать с локальным блокчейном Ganache. Для этого воспользуемся консолью Truffle. Запускается она следующей командой, и без явного указания сети \(с помощью ключа --network\) коннектится к **development**, конфигурация которого у нас и описана в **truffle-config.js**

```javascript
truffle console
```

В случае успеха мы увидим подтверждение того, что находимся в консоли Truffle

```javascript
truffle(development)> 
```

В целом, все взаимодействия в Truffle Suit стоит производить из консоли. Можно работать и не через нее, но в таком случае в начале каждой команды придется писать ключевое слово truffle, а в случае работы не с сетью development еще и указывать каждый раз сеть, что не так удобно. В гайде для всех команд в консоли Truffle я буду использовать префикс truffle\(NETWORK\)&gt;. Очевидно, что его не надо вводить, это лишь часть интерфейса консоли.

Взаимодействие с блокчейном происходит посредством запросов на языке JavaScript и с использованием библиотеки web3.js. Ничего импортировать не надо - Truffle Suite по-умолчанию включает все необходимые нам инструменты.

Итак, получим доступные \(наши\) адреса через консоль. Они будут совпадать с адресами в Ganache. Для этого воспользуемся командой **web3.eth.getAccounts\(\)**

```javascript
truffle(development)> web3.eth.getAccounts()
[
  '0x9D53F6CaC7c404Cc4756244651a21B8404df1638',
  '0x07E08A1cDa123e3a3537525a6Cdf8D5deafAC95e',
  '0xA3a93F870FbB9AA5A9AeACb1609535B7D023F54F',
  '0x08273814886E5556Bfc17E16dD449a3F35e7083C',
  '0x08b8099D0026147e801fceEAd85A81C5Bbed87cc',
  '0x5BB9E61E1F728A4cFa974B8223296deaEEBB53b7',
  '0x4Ea02f681E5b8eCd08dFb68e1ea88E60A040E182',
  '0x29496A3041F2A4C0cFd3946212d100BB5704BB14',
  '0x647e3Ad8c65E30746E7392577126808bf71920fE',
  '0x9ed242859bEc5F7845615cB464cCf6a626790350'
]
```

Теперь получим баланс ETH для любого из акаунтов с помощью **web3.eth.getBalance**, в которую в качестве аргумента передается любой адрес кошелька.

```javascript
truffle(development)> web3.eth.getBalance('0x08b8099D0026147e801fceEAd85A81C5Bbed87cc')
'100000000000000000000'
```

Тут стоит обратить внимание, что баланс исчисляется в **wei**, т.е. в **1/18 от ETH.** Причина этого проста - Solidity не поддерживает работу с дробными числами, зато отлично работает с гигантскими целыми. В результате выполнения команды мы получили строку, а не число. Это же, в свою очередь потому, что JavaScript поддерживает работу с дробными, но не умеет обращаться с такими большими целыми числами. Для того, чтобы несколько сгладить такое неудобство, у библиотеки web3 есть конвертор из wei в  ETH - **web3.utils.fromWei**. В качестве аргумента он принимает wei, а отдает ETH.

```javascript
truffle(development)> web3.utils.fromWei('100000000000000000000')
'100'
```

Итак, если все работает, то пора переходить к самому главному и интересному - написанию первого контракта!

